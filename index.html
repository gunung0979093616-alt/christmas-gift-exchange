<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è–èª•ç¯€äº¤æ›ç¦®ç‰©</title>
    
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5933290508786919"
     crossorigin="anonymous"></script>
    
    <!-- è¯ç›Ÿå»£å‘Š -->
    <script>var ConverlyCustomData = {channelId: null};</script>
    <script async defer src="https://cdn.affiliates.one/production/adlinks/5cf270f7431fc30a7943ffeb151fe35d322fc4061aa3a09cc5cc884210293a8a.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #1a472a 0%, #2d5a3d 50%, #1a472a 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }
        
        /* è–èª•ç¯€èƒŒæ™¯å‹•ç•« */
        @keyframes snowfall {
            0% { transform: translateY(-100px) translateX(0); opacity: 1; }
            100% { transform: translateY(100vh) translateX(100px); opacity: 0.3; }
        }
        
        @keyframes giftFloat {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(10deg); }
        }
        
        .snowflake {
            position: fixed;
            top: -10px;
            color: white;
            font-size: 20px;
            opacity: 0.8;
            pointer-events: none;
            z-index: 1;
            animation: snowfall linear infinite;
        }
        
        .gift-decoration {
            position: fixed;
            font-size: 30px;
            opacity: 0.3;
            pointer-events: none;
            z-index: 1;
            animation: giftFloat 3s ease-in-out infinite;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            position: relative;
            z-index: 2;
            backdrop-filter: blur(10px);
        }
        h1 {
            text-align: center;
            color: #c41e3a;
            font-size: 28px;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        h2 {
            color: #c41e3a;
            font-size: 20px;
            margin-bottom: 15px;
        }
        .section {
            display: none;
        }
        .section.active {
            display: block;
        }
        .btn {
            width: 100%;
            padding: 16px;
            margin: 10px 0;
            border: none;
            border-radius: 12px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            background: linear-gradient(135deg, #c41e3a 0%, #8b1a2e 100%);
            color: white;
            transition: transform 0.2s;
            box-shadow: 0 4px 15px rgba(196, 30, 58, 0.3);
        }
        .btn:active {
            transform: scale(0.98);
        }
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            box-shadow: none;
        }
        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        }
        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
        }
        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }
        .btn-small {
            padding: 10px;
            font-size: 14px;
            margin: 5px 0;
        }
        input, textarea, select {
            width: 100%;
            padding: 14px;
            margin: 10px 0;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            font-size: 16px;
        }
        textarea {
            min-height: 100px;
            font-family: inherit;
            resize: vertical;
        }
        input[readonly] {
            background: #f0f0f0;
        }
        input[type="checkbox"] {
            width: auto;
            margin-right: 10px;
        }
        .label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-top: 15px;
            margin-bottom: 8px;
            font-size: 15px;
        }
        .card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        .info-box {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 4px solid #c41e3a;
        }
        .info-label {
            font-size: 13px;
            color: #666;
            margin-bottom: 5px;
        }
        .info-value {
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }
        .activity-item {
            background: white;
            padding: 16px;
            margin: 10px 0;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.2s;
        }
        .activity-item:hover {
            transform: translateY(-2px);
        }
        .activity-name {
            font-weight: 600;
            font-size: 18px;
            color: #c41e3a;
            margin-bottom: 8px;
        }
        .activity-date {
            font-size: 14px;
            color: #666;
            margin-bottom: 4px;
        }
        .activity-participants {
            font-size: 14px;
            color: #999;
        }
        .player-list {
            margin: 20px 0;
        }
        .player-item {
            background: white;
            padding: 16px;
            margin: 10px 0;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .player-name {
            font-weight: 600;
            font-size: 17px;
            color: #333;
            margin-bottom: 8px;
        }
        .player-gift {
            font-size: 14px;
            color: #666;
            line-height: 1.5;
        }
        .gift-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 8px;
        }
        .gift-available {
            background: #d4edda;
            color: #155724;
        }
        .gift-taken {
            background: #f8d7da;
            color: #721c24;
        }
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }
        .empty-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }
        .status-bar {
            background: linear-gradient(135deg, #c41e3a 0%, #8b1a2e 100%);
            color: white;
            padding: 16px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(196, 30, 58, 0.3);
        }
        .btn-group {
            display: flex;
            gap: 10px;
        }
        .btn-group .btn {
            flex: 1;
        }
        
        /* å»£å‘Šå®¹å™¨ */
        .ad-container {
            margin: 20px 0;
            padding: 10px;
            text-align: center;
            min-height: 90px;
            background: #f8f9fa;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .ad-container-top {
            margin-bottom: 20px;
        }
        .ad-container-bottom {
            margin-top: 20px;
        }
        
        .checkbox-label {
            display: flex;
            align-items: center;
            margin: 15px 0;
            cursor: pointer;
        }
        
        /* è½‰ç›¤æ¨£å¼ */
        .wheel-container {
            position: relative;
            width: 320px;
            height: 320px;
            margin: 30px auto;
        }
        .wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 10px solid #c41e3a;
            position: relative;
            transition: transform 3s cubic-bezier(0.17, 0.67, 0.12, 0.99);
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 50%, #ffd700 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 30px rgba(196, 30, 58, 0.3),
                        inset 0 0 30px rgba(255, 255, 255, 0.3);
        }
        .wheel-center {
            position: absolute;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #c41e3a 0%, #8b1a2e 100%);
            border-radius: 50%;
            z-index: 10;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            border: 3px solid #ffd700;
        }
        .wheel-pointer {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 40px solid #c41e3a;
            z-index: 20;
            filter: drop-shadow(0 3px 5px rgba(0,0,0,0.3));
        }
        .wheel-names {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            font-size: 16px;
            font-weight: 700;
            color: #8b1a2e;
            text-shadow: 1px 1px 2px rgba(255,255,255,0.5);
        }
        .result-box {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            border: 3px solid #c41e3a;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            margin: 20px 0;
            box-shadow: 0 5px 20px rgba(196, 30, 58, 0.3);
        }
        .result-name {
            font-size: 36px;
            font-weight: 700;
            color: #c41e3a;
            margin: 10px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <!-- è–èª•ç¯€è£é£¾ -->
    <div class="snowflake" style="left: 10%; animation-duration: 10s; animation-delay: 0s;">â„</div>
    <div class="snowflake" style="left: 20%; animation-duration: 12s; animation-delay: 2s;">â„</div>
    <div class="snowflake" style="left: 30%; animation-duration: 15s; animation-delay: 4s;">â„</div>
    <div class="snowflake" style="left: 40%; animation-duration: 11s; animation-delay: 1s;">â„</div>
    <div class="snowflake" style="left: 50%; animation-duration: 13s; animation-delay: 3s;">â„</div>
    <div class="snowflake" style="left: 60%; animation-duration: 14s; animation-delay: 5s;">â„</div>
    <div class="snowflake" style="left: 70%; animation-duration: 10s; animation-delay: 2s;">â„</div>
    <div class="snowflake" style="left: 80%; animation-duration: 12s; animation-delay: 4s;">â„</div>
    <div class="snowflake" style="left: 90%; animation-duration: 11s; animation-delay: 1s;">â„</div>
    
    <div class="gift-decoration" style="top: 10%; left: 5%; animation-delay: 0s;">ğŸ</div>
    <div class="gift-decoration" style="top: 20%; right: 5%; animation-delay: 1s;">ğŸ„</div>
    <div class="gift-decoration" style="bottom: 20%; left: 8%; animation-delay: 2s;">ğŸ…</div>
    <div class="gift-decoration" style="bottom: 15%; right: 8%; animation-delay: 1.5s;">â­</div>
    
    <div class="container">
        <h1>ğŸ è–èª•ç¯€äº¤æ›ç¦®ç‰©</h1>

        <!-- é¦–é  -->
        <div id="home-section" class="section active">
            <div class="card" style="background: #fff3cd; border-left: 4px solid #ffc107;">
                <h2 style="color: #856404;">ğŸ“‹ ä½¿ç”¨è¦å‰‡èˆ‡é™åˆ¶</h2>
                <div style="font-size: 14px; line-height: 1.8; color: #856404;">
                    <p style="margin: 8px 0;">1. æ¯å€‹æ´»å‹•éƒ½æœ‰å°ˆå±¬é€£çµï¼Œè«‹å¦¥å–„ä¿ç®¡</p>
                    <p style="margin: 8px 0;">2. <strong>åªèƒ½é€éé‚€è«‹é€£çµåƒåŠ æ´»å‹•</strong></p>
                    <p style="margin: 8px 0;">3. è¼¸å…¥é›»è©±å¯æŸ¥è©¢æ´»å‹•è³‡è¨Šï¼Œä½†ç„¡æ³•åŠ å…¥</p>
                    <p style="margin: 8px 0;">4. å…¬é–‹æ´»å‹•å¯è¢«æœå°‹ï¼Œä½†ä»éœ€é€£çµæ‰èƒ½åƒåŠ </p>
                    <p style="margin: 8px 0;">5. ç™¼èµ·äººé›»è©±åƒ…ç”¨æ–¼æŸ¥è©¢ï¼Œä¸æœƒå…¬é–‹é¡¯ç¤º</p>
                    <p style="margin: 8px 0;">6. è«‹å‹¿æƒ¡æ„å»ºç«‹æˆ–ç ´å£æ´»å‹•</p>
                </div>
            </div>
            
            <div class="card">
                <h2>æŸ¥çœ‹æˆ‘çš„æ´»å‹•</h2>
                <label class="label">è¼¸å…¥ç™¼èµ·äººé›»è©±</label>
                <input type="tel" id="my-phone-input" placeholder="è«‹è¼¸å…¥æ‚¨çš„é›»è©±è™Ÿç¢¼">
                <button class="btn" onclick="loadMyActivities()">æŸ¥çœ‹æˆ‘çš„æ´»å‹•</button>
            </div>

            <div class="card">
                <h2>æœå°‹å…¬é–‹æ´»å‹•</h2>
                <label class="label">é¸æ“‡æ—¥æœŸ</label>
                <input type="date" id="search-date-input">
                <button class="btn" onclick="searchByDate()">æœå°‹</button>
            </div>

            <div class="card">
                <button class="btn" onclick="showCreateForm()">æ–°å»ºç«‹äº¤æ›ç¦®ç‰©æ´»å‹•</button>
            </div>
            
            <!-- è¯ç›Ÿå»£å‘Š -->
            <div class="ad-container ad-container-bottom"></div>
        </div>

        <!-- æˆ‘çš„æ´»å‹•åˆ—è¡¨ -->
        <div id="my-activities-section" class="section">
            <div class="status-bar">æˆ‘çš„æ´»å‹•</div>
            
            <!-- Google Ads è‡ªå‹•å»£å‘Š -->
            <div class="ad-container ad-container-top"></div>
            
            <div id="my-activities-list"></div>
            <button class="btn btn-secondary" onclick="showHome()">è¿”å›é¦–é </button>
            
            <!-- è¯ç›Ÿå»£å‘Š -->
            <div class="ad-container ad-container-bottom"></div>
        </div>

        <!-- æ—¥æœŸæœå°‹çµæœ -->
        <div id="date-search-section" class="section">
            <div class="status-bar">
                æœå°‹çµæœï¼š<span id="search-date-display"></span>
            </div>
            <div id="date-search-list"></div>
            <button class="btn btn-secondary" onclick="showHome()">è¿”å›é¦–é </button>
        </div>

        <!-- å»ºç«‹æ´»å‹•è¡¨å–® -->
        <div id="create-form-section" class="section">
            <div class="card">
                <h2>å»ºç«‹äº¤æ›ç¦®ç‰©æ´»å‹•</h2>
                
                <label class="label">æ´»å‹•åç¨± *</label>
                <input type="text" id="activity-name" placeholder="ä¾‹å¦‚ï¼šå…¬å¸è–èª•è¶´">
                
                <label class="label">ç™¼èµ·äººå§“å *</label>
                <input type="text" id="host-name-input" placeholder="è«‹è¼¸å…¥æ‚¨çš„å§“å">
                
                <label class="label">ç™¼èµ·äººé›»è©± *</label>
                <input type="tel" id="host-phone-input" placeholder="è«‹è¼¸å…¥è¯çµ¡é›»è©±">
                
                <label class="label">äº¤æ›ç¦®ç‰©æ™‚é–“ *</label>
                <input type="datetime-local" id="exchange-datetime-input">
                
                <label class="label">äº¤æ›ç¦®ç‰©åœ°é» *</label>
                <input type="text" id="exchange-location-input" placeholder="è«‹è¼¸å…¥åœ°é»">
                
                <label class="checkbox-label">
                    <input type="checkbox" id="is-public-checkbox">
                    è¨­ç‚ºå…¬é–‹æ´»å‹•ï¼ˆå…¶ä»–äººå¯é€éæ—¥æœŸæœå°‹çœ‹åˆ°ï¼‰
                </label>
                
                <button class="btn" onclick="createActivity()">å»ºç«‹æ´»å‹•</button>
                <button class="btn btn-secondary" onclick="showHome()">è¿”å›</button>
            </div>
        </div>

        <!-- æ´»å‹•è³‡è¨Š - ç™¼èµ·äººè¦–è§’ -->
        <div id="activity-info-section" class="section">
            <div class="card">
                <h2 style="text-align: center; color: #667eea;" id="activity-title-display">æ´»å‹•åç¨±</h2>
                
                <div class="info-box">
                    <div class="info-label">ç™¼èµ·äºº</div>
                    <div class="info-value" id="host-info-display">---</div>
                </div>
                
                <div class="info-box">
                    <div class="info-label">ç™¼èµ·æ™‚é–“</div>
                    <div class="info-value" id="create-time-display">---</div>
                </div>
                
                <div class="info-box">
                    <div class="info-label">äº¤æ›æ™‚é–“</div>
                    <div class="info-value" id="exchange-time-display">---</div>
                </div>
                
                <div class="info-box">
                    <div class="info-label">äº¤æ›åœ°é»</div>
                    <div class="info-value" id="exchange-location-display">---</div>
                </div>
            </div>
            
            <div class="card">
                <label class="label">é‚€è«‹é€£çµ</label>
                <input type="text" id="invite-link-display" readonly>
                <button class="btn" onclick="copyInviteLink()">è¤‡è£½é€£çµ</button>
            </div>
            
            <div class="card">
                <h2>åƒåŠ è€…åå–®ï¼ˆ<span id="info-participant-count">0</span>äººï¼‰</h2>
                <div id="info-participants-list"></div>
                <button class="btn btn-success" onclick="showAddParticipantForm()">æ–°å¢åƒåŠ è€…</button>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-success" onclick="enterGameFromInfo()">é–‹å§‹äº¤æ›ç¦®ç‰©</button>
                <button class="btn btn-danger" onclick="confirmDeleteActivity()">åˆªé™¤æ´»å‹•</button>
            </div>
            <button class="btn btn-secondary" onclick="backToMyActivities()">è¿”å›</button>
            
            <!-- Google Ads è‡ªå‹•å»£å‘Š -->
            <div class="ad-container ad-container-bottom"></div>
        </div>

        <!-- åƒåŠ æ´»å‹• - è¼¸å…¥ä»£ç¢¼ -->
        <div id="join-code-section" class="section">
            <div class="card">
                <h2>åƒåŠ æ´»å‹•</h2>
                <label class="label">è¼¸å…¥æ´»å‹•ä»£ç¢¼</label>
                <input type="text" id="join-code-input" placeholder="6ä½æ•¸ä»£ç¢¼" 
                       maxlength="6" style="text-align: center; font-size: 24px; letter-spacing: 4px; text-transform: uppercase;">
                <button class="btn" onclick="joinByCode()">ç¢ºèª</button>
                <button class="btn btn-secondary" onclick="showHome()">è¿”å›</button>
            </div>
        </div>

        <!-- æ´»å‹•è³‡è¨Š - åƒåŠ è€…è¦–è§’ -->
        <div id="participant-view-section" class="section">
            <div class="card" style="background: #fff3cd; border: 2px solid #ffc107;">
                <p style="color: #856404; font-size: 14px; margin: 0;">
                    âš ï¸ é€éé›»è©±æŸ¥è©¢åªèƒ½æŸ¥çœ‹è³‡è¨Šï¼Œ<strong>ç„¡æ³•åƒåŠ æ´»å‹•</strong><br>
                    è«‹ä½¿ç”¨é‚€è«‹é€£çµæ‰èƒ½åƒåŠ 
                </p>
            </div>
            
            <div class="card">
                <h2 style="text-align: center; color: #667eea;" id="participant-activity-title">æ´»å‹•åç¨±</h2>
                
                <div class="info-box">
                    <div class="info-label">ç™¼èµ·äºº</div>
                    <div class="info-value" id="participant-host-info">---</div>
                </div>
                
                <div class="info-box">
                    <div class="info-label">ç™¼èµ·æ™‚é–“</div>
                    <div class="info-value" id="participant-create-time">---</div>
                </div>
                
                <div class="info-box">
                    <div class="info-label">äº¤æ›æ™‚é–“</div>
                    <div class="info-value" id="participant-exchange-time">---</div>
                </div>
                
                <div class="info-box">
                    <div class="info-label">äº¤æ›åœ°é»</div>
                    <div class="info-value" id="participant-exchange-location">---</div>
                </div>
            </div>
            
            <div class="card">
                <button class="btn" onclick="viewParticipantsList()">æŸ¥çœ‹åƒåŠ è€…åå–®</button>
                <button class="btn btn-secondary" onclick="showHome()">è¿”å›</button>
            </div>
        </div>

        <!-- é€éé€£çµé€²å…¥ - åƒåŠ è€…è¦–è§’ -->
        <div id="link-participant-view-section" class="section">
            <div class="card">
                <h2 style="text-align: center; color: #c41e3a;" id="link-activity-title">æ´»å‹•åç¨±</h2>
                
                <div class="info-box">
                    <div class="info-label">ç™¼èµ·äºº</div>
                    <div class="info-value" id="link-host-info">---</div>
                </div>
                
                <div class="info-box">
                    <div class="info-label">ç™¼èµ·æ™‚é–“</div>
                    <div class="info-value" id="link-create-time">---</div>
                </div>
                
                <div class="info-box">
                    <div class="info-label">äº¤æ›æ™‚é–“</div>
                    <div class="info-value" id="link-exchange-time">---</div>
                </div>
                
                <div class="info-box">
                    <div class="info-label">äº¤æ›åœ°é»</div>
                    <div class="info-value" id="link-exchange-location">---</div>
                </div>
            </div>
            
            <div class="card">
                <button class="btn" onclick="viewParticipantsFromLink()">æŸ¥çœ‹åƒåŠ è€…åå–®</button>
                <button class="btn btn-success" onclick="showJoinForm()">æˆ‘è¦åƒåŠ </button>
                <button class="btn btn-secondary" onclick="showHome()">è¿”å›é¦–é </button>
            </div>
        </div>

        <!-- é€éé€£çµæŸ¥çœ‹åƒåŠ è€… -->
        <div id="link-view-participants-section" class="section">
            <div class="status-bar">
                åƒåŠ äººæ•¸: <span id="link-participant-count">0</span>
            </div>
            <div id="link-participants-list"></div>
            <button class="btn btn-success" onclick="showJoinForm()">æˆ‘ä¹Ÿè¦åƒåŠ </button>
            <button class="btn btn-secondary" onclick="backToLinkParticipantView()">è¿”å›</button>
        </div>

        <!-- æŸ¥çœ‹åƒåŠ è€…åå–® -->
        <div id="view-participants-section" class="section">
            <div class="status-bar">
                åƒåŠ äººæ•¸: <span id="view-participant-count">0</span>
            </div>
            <div id="view-participants-list"></div>
            <button class="btn btn-secondary" onclick="backToParticipantView()">è¿”å›</button>
        </div>

        <!-- å¡«å¯«åƒåŠ è³‡è¨Š -->
        <div id="join-form-section" class="section">
            <div class="card">
                <h2>å¡«å¯«åƒåŠ è³‡è¨Š</h2>
                
                <label class="label">æ‚¨çš„å§“å *</label>
                <input type="text" id="participant-name-input" placeholder="è«‹è¼¸å…¥æ‚¨çš„å§“å">
                
                <label class="label">ç¦®ç‰©æè¿°</label>
                <textarea id="participant-gift-input" placeholder="æè¿°æ‚¨è¦å¸¶çš„ç¦®ç‰©æ–¹å‘ï¼ˆä¾‹å¦‚ï¼šæ–‡å…·é¡ã€ç¾é£Ÿã€3Cé…ä»¶ï¼‰
å¯ä»¥å…ˆä¸å¡«ï¼Œä¹‹å¾Œå†è£œå……"></textarea>
                
                <button class="btn btn-success" onclick="saveParticipant()">å„²å­˜</button>
                <button class="btn btn-secondary" onclick="backToParticipantView()">è¿”å›</button>
            </div>
        </div>

        <!-- æ–°å¢åƒåŠ è€…è¡¨å–®ï¼ˆç™¼èµ·äººç”¨ï¼‰ -->
        <div id="add-participant-section" class="section">
            <div class="card">
                <h2>æ–°å¢åƒåŠ è€…</h2>
                
                <label class="label">åƒåŠ è€…å§“å *</label>
                <input type="text" id="add-participant-name" placeholder="è«‹è¼¸å…¥åƒåŠ è€…å§“å">
                
                <label class="label">ç¦®ç‰©æè¿°</label>
                <textarea id="add-participant-gift" placeholder="æè¿°ç¦®ç‰©æ–¹å‘ï¼ˆä¾‹å¦‚ï¼šæ–‡å…·é¡ã€ç¾é£Ÿã€3Cé…ä»¶ï¼‰
å¯ä»¥å…ˆä¸å¡«ï¼Œä¹‹å¾Œå†è£œå……"></textarea>
                
                <button class="btn btn-success" onclick="addParticipantByHost()">æ–°å¢</button>
                <button class="btn btn-secondary" onclick="backToActivityInfoFromAdd()">è¿”å›</button>
            </div>
        </div>

        <!-- éŠæˆ²ç‰ˆé¢ -->
        <div id="game-section" class="section">
            <div class="status-bar">
                <span id="game-activity-name-display">æ´»å‹•åç¨±</span>
            </div>

            <div class="card">
                <h2>è½‰ç›¤æŠ½é¸</h2>
                <div class="wheel-container">
                    <div class="wheel-pointer"></div>
                    <div class="wheel" id="wheel">
                        <div class="wheel-names" id="wheel-names"></div>
                        <div class="wheel-center"></div>
                    </div>
                </div>
                <button class="btn btn-success" id="spin-btn" onclick="spinWheel()">é–‹å§‹äº¤æ›ç¦®ç‰©</button>
                <div id="result-display"></div>
            </div>

            <div class="card">
                <h2>ç¦®ç‰©ç®¡ç†</h2>
                <div id="gifts-list"></div>
            </div>

            <div class="card">
                <h2>åƒåŠ è€…åå–®ï¼ˆ<span id="game-participant-count">0</span>äººï¼‰</h2>
                <div id="game-participants-list"></div>
            </div>

            <button class="btn btn-secondary" onclick="backToActivityInfoFromGame()">è¿”å›æ´»å‹•è³‡è¨Š</button>
            
            <!-- Google Ads è‡ªå‹•å»£å‘Š -->
            <div class="ad-container ad-container-bottom"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/dist/umd/supabase.min.js"></script>
    <script>
        const SUPABASE_CONFIG = {
            url: 'https://ilbeqpmwnouxhrblzegk.supabase.co',
            key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlsYmVxcG13bm91eGhyYmx6ZWdrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU5NzI4MDgsImV4cCI6MjA4MTU0ODgwOH0.pf9fvXJlhF1yRI2ZOjTe3vv27KiY5DmTiI1ZmboSM4E'
        };

        let supabase;
        let currentGameCode = null;
        let currentActivityData = null;
        let currentUserPhone = null;
        let pollInterval = null;
        let wheelRotation = 0;
        let participants = [];

        // åˆå§‹åŒ–
        function init() {
            supabase = window.supabase.createClient(SUPABASE_CONFIG.url, SUPABASE_CONFIG.key);
            
            // æª¢æŸ¥ URL æ˜¯å¦æœ‰ code åƒæ•¸
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');
            
            if (code) {
                currentGameCode = code;
                loadActivityForParticipant();
            }
        }

        // è‡ªå‹•åˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', init);

        // é¡¯ç¤ºå€å¡Š
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
        }

        // é¡¯ç¤ºé¦–é 
        function showHome() {
            stopPolling();
            currentGameCode = null;
            currentActivityData = null;
            showSection('home-section');
        }

        // æ ¼å¼åŒ–æ—¥æœŸæ™‚é–“
        function formatDateTime(date) {
            const d = new Date(date);
            const year = d.getFullYear();
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const day = String(d.getDate()).padStart(2, '0');
            const hours = String(d.getHours()).padStart(2, '0');
            const minutes = String(d.getMinutes()).padStart(2, '0');
            return `${year}/${month}/${day} ${hours}:${minutes}`;
        }

        // è¼‰å…¥æˆ‘çš„æ´»å‹•
        async function loadMyActivities() {
            try {
                const phone = document.getElementById('my-phone-input').value.trim();
                
                if (!phone) {
                    alert('è«‹è¼¸å…¥é›»è©±è™Ÿç¢¼');
                    return;
                }

                currentUserPhone = phone;

                const { data, error } = await supabase
                    .from('games')
                    .select('*')
                    .eq('host_phone', phone)
                    .order('created_at', { ascending: false });

                if (error) throw error;

                const activities = data || [];
                displayMyActivities(activities);
                showSection('my-activities-section');
            } catch (error) {
                alert('è¼‰å…¥å¤±æ•—ï¼š' + error.message);
            }
        }

        // é¡¯ç¤ºæˆ‘çš„æ´»å‹•åˆ—è¡¨
        function displayMyActivities(activities) {
            const listDiv = document.getElementById('my-activities-list');
            
            if (activities.length === 0) {
                listDiv.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“‹</div>
                        <div>æ‚¨é‚„æ²’æœ‰å»ºç«‹ä»»ä½•æ´»å‹•</div>
                    </div>
                `;
            } else {
                listDiv.innerHTML = activities.map(activity => `
                    <div class="activity-item">
                        <div class="activity-name">${activity.activity_name}</div>
                        <div class="activity-date">ğŸ“… ${formatDateTime(activity.exchange_datetime)}</div>
                        <div class="activity-date">ğŸ“ ${activity.exchange_location}</div>
                        <button class="btn btn-small" onclick="viewActivityInfo('${activity.game_code}'); event.stopPropagation();">
                            äº†è§£åƒåŠ äººå“¡
                        </button>
                    </div>
                `).join('');
            }
        }

        // æŸ¥çœ‹æ´»å‹•è³‡è¨Š
        async function viewActivityInfo(gameCode) {
            try {
                currentGameCode = gameCode;

                const { data, error } = await supabase
                    .from('games')
                    .select('*')
                    .eq('game_code', gameCode)
                    .single();

                if (error) throw error;

                currentActivityData = data;
                displayActivityInfo();
                showSection('activity-info-section');
                startPolling('info');
            } catch (error) {
                alert('è¼‰å…¥å¤±æ•—ï¼š' + error.message);
            }
        }

        // é¡¯ç¤ºæ´»å‹•è³‡è¨Š
        function displayActivityInfo() {
            const data = currentActivityData;
            
            document.getElementById('activity-title-display').textContent = data.activity_name;
            document.getElementById('host-info-display').textContent = `${data.host_name} (${data.host_phone})`;
            document.getElementById('create-time-display').textContent = formatDateTime(data.created_at);
            document.getElementById('exchange-time-display').textContent = formatDateTime(data.exchange_datetime);
            document.getElementById('exchange-location-display').textContent = data.exchange_location;
            
            const baseUrl = window.location.href.split('?')[0];
            const inviteLink = `${baseUrl}?code=${data.game_code}`;
            document.getElementById('invite-link-display').value = inviteLink;
        }

        // è¤‡è£½é‚€è«‹é€£çµ
        function copyInviteLink() {
            const linkInput = document.getElementById('invite-link-display');
            linkInput.select();
            document.execCommand('copy');
            alert('âœ… é€£çµå·²è¤‡è£½ï¼');
        }

        // è¿”å›æˆ‘çš„æ´»å‹•
        function backToMyActivities() {
            stopPolling();
            loadMyActivities();
        }

        // æ—¥æœŸæœå°‹
        async function searchByDate() {
            try {
                const dateInput = document.getElementById('search-date-input').value;
                
                if (!dateInput) {
                    alert('è«‹é¸æ“‡æ—¥æœŸ');
                    return;
                }

                const searchDate = new Date(dateInput);
                const startDate = new Date(searchDate);
                startDate.setHours(0, 0, 0, 0);
                const endDate = new Date(searchDate);
                endDate.setHours(23, 59, 59, 999);

                const { data, error } = await supabase
                    .from('games')
                    .select('*')
                    .eq('is_public', true)
                    .gte('exchange_datetime', startDate.toISOString())
                    .lte('exchange_datetime', endDate.toISOString())
                    .order('exchange_datetime');

                if (error) throw error;

                document.getElementById('search-date-display').textContent = dateInput;
                displayDateSearchResults(data || []);
                showSection('date-search-section');
            } catch (error) {
                alert('æœå°‹å¤±æ•—ï¼š' + error.message);
            }
        }

        // é¡¯ç¤ºæ—¥æœŸæœå°‹çµæœ
        function displayDateSearchResults(activities) {
            const listDiv = document.getElementById('date-search-list');
            
            if (activities.length === 0) {
                listDiv.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ”</div>
                        <div>æ­¤æ—¥æœŸæ²’æœ‰å…¬é–‹æ´»å‹•</div>
                    </div>
                `;
            } else {
                listDiv.innerHTML = activities.map(activity => `
                    <div class="activity-item">
                        <div class="activity-name">${activity.activity_name}</div>
                        <div class="activity-date">ğŸ“… ${formatDateTime(activity.exchange_datetime)}</div>
                        <div class="activity-date">ğŸ‘¤ ç™¼èµ·äººï¼š${activity.host_name}</div>
                        <div style="margin-top: 10px; padding: 10px; background: #fff3cd; border-radius: 8px; font-size: 13px; color: #856404;">
                            âš ï¸ æ­¤ç‚ºå…¬é–‹æ´»å‹•è³‡è¨Š<br>
                            éœ€è¦é‚€è«‹é€£çµæ‰èƒ½åƒåŠ 
                        </div>
                    </div>
                `).join('');
            }
        }

        // é¡¯ç¤ºå»ºç«‹æ´»å‹•è¡¨å–®
        function showCreateForm() {
            showSection('create-form-section');
        }

        // å»ºç«‹æ´»å‹•
        async function createActivity() {
            try {
                const activityName = document.getElementById('activity-name').value.trim();
                const hostName = document.getElementById('host-name-input').value.trim();
                const hostPhone = document.getElementById('host-phone-input').value.trim();
                const exchangeDatetime = document.getElementById('exchange-datetime-input').value;
                const exchangeLocation = document.getElementById('exchange-location-input').value.trim();
                const isPublic = document.getElementById('is-public-checkbox').checked;

                if (!activityName || !hostName || !hostPhone || !exchangeDatetime || !exchangeLocation) {
                    alert('è«‹å¡«å¯«æ‰€æœ‰å¿…å¡«æ¬„ä½');
                    return;
                }

                currentGameCode = Math.random().toString(36).substring(2, 8).toUpperCase();
                currentUserPhone = hostPhone;
                
                const { data, error } = await supabase
                    .from('games')
                    .insert({
                        game_code: currentGameCode,
                        activity_name: activityName,
                        host_name: hostName,
                        host_phone: hostPhone,
                        exchange_datetime: exchangeDatetime,
                        exchange_location: exchangeLocation,
                        is_public: isPublic,
                        max_steals: 3,
                        game_started: false,
                        game_ended: false
                    })
                    .select()
                    .single();

                if (error) throw error;

                currentActivityData = data;

                // ç™¼èµ·äººè‡ªå‹•åŠ å…¥
                await supabase
                    .from('participants')
                    .insert({
                        game_code: currentGameCode,
                        name: hostName,
                        gift: '(ç™¼èµ·äºº)',
                        player_order: 0
                    });

                // æ¸…ç©ºè¡¨å–®
                document.getElementById('activity-name').value = '';
                document.getElementById('host-name-input').value = '';
                document.getElementById('host-phone-input').value = '';
                document.getElementById('exchange-datetime-input').value = '';
                document.getElementById('exchange-location-input').value = '';
                document.getElementById('is-public-checkbox').checked = false;

                alert('âœ… æ´»å‹•å»ºç«‹æˆåŠŸï¼');
                displayActivityInfo();
                showSection('activity-info-section');
                startPolling('info');
            } catch (error) {
                alert('å»ºç«‹å¤±æ•—ï¼š' + error.message);
            }
        }

        // åˆªé™¤æ´»å‹•
        function confirmDeleteActivity() {
            if (confirm('ç¢ºå®šè¦åˆªé™¤æ­¤æ´»å‹•å—ï¼Ÿ\nåˆªé™¤å¾Œæ‰€æœ‰åƒèˆ‡è€…è³‡æ–™å°‡ä¸€ä½µç§»é™¤ã€‚')) {
                deleteActivity();
            }
        }

        async function deleteActivity() {
            try {
                const { error } = await supabase
                    .from('games')
                    .delete()
                    .eq('game_code', currentGameCode);

                if (error) throw error;

                alert('âœ… æ´»å‹•å·²åˆªé™¤');
                loadMyActivities();
            } catch (error) {
                alert('åˆªé™¤å¤±æ•—ï¼š' + error.message);
            }
        }

        // é¡¯ç¤ºè¼¸å…¥ä»£ç¢¼
        function showJoinByCode() {
            document.getElementById('join-code-input').value = '';
            showSection('join-code-section');
        }

        // é€šéä»£ç¢¼åƒåŠ 
        async function joinByCode() {
            try {
                const code = document.getElementById('join-code-input').value.trim().toUpperCase();
                
                if (!code || code.length !== 6) {
                    alert('è«‹è¼¸å…¥6ä½æ•¸æ´»å‹•ä»£ç¢¼');
                    return;
                }

                currentGameCode = code;
                await loadActivityForParticipant();
            } catch (error) {
                alert('è¼‰å…¥å¤±æ•—ï¼š' + error.message);
            }
        }

        // è¼‰å…¥æ´»å‹•è³‡è¨Šï¼ˆåƒåŠ è€…è¦–è§’ï¼‰
        async function loadActivityForParticipant() {
            try {
                const { data, error } = await supabase
                    .from('games')
                    .select('*')
                    .eq('game_code', currentGameCode)
                    .single();

                if (error || !data) {
                    alert('æ´»å‹•ä¸å­˜åœ¨æˆ–å·²è¢«åˆªé™¤');
                    showHome();
                    return;
                }

                currentActivityData = data;

                // é€éé€£çµé€²å…¥ - é¡¯ç¤ºå®Œæ•´è³‡è¨Šï¼Œå¯ä»¥åƒåŠ 
                document.getElementById('link-activity-title').textContent = data.activity_name;
                document.getElementById('link-host-info').textContent = data.host_name;
                document.getElementById('link-create-time').textContent = formatDateTime(data.created_at);
                document.getElementById('link-exchange-time').textContent = formatDateTime(data.exchange_datetime);
                document.getElementById('link-exchange-location').textContent = data.exchange_location;

                showSection('link-participant-view-section');
            } catch (error) {
                alert('è¼‰å…¥å¤±æ•—ï¼š' + error.message);
            }
        }

        // æŸ¥çœ‹åƒåŠ è€…åå–®
        function viewParticipantsList() {
            showSection('view-participants-section');
            startPolling('view');
        }

        // è¿”å›åƒåŠ è€…è¦–è§’
        function backToParticipantView() {
            stopPolling();
            showSection('participant-view-section');
        }

        // é€éé€£çµæŸ¥çœ‹åƒåŠ è€…
        function viewParticipantsFromLink() {
            showSection('link-view-participants-section');
            startPolling('link-view');
        }

        // è¿”å›é€£çµé€²å…¥çš„æ´»å‹•é é¢
        function backToLinkParticipantView() {
            stopPolling();
            showSection('link-participant-view-section');
        }

        // é¡¯ç¤ºåƒåŠ è¡¨å–®
        function showJoinForm() {
            document.getElementById('participant-name-input').value = '';
            document.getElementById('participant-gift-input').value = '';
            showSection('join-form-section');
        }

        // å„²å­˜åƒåŠ è€…
        async function saveParticipant() {
            try {
                const name = document.getElementById('participant-name-input').value.trim();
                
                if (!name) {
                    alert('è«‹è¼¸å…¥æ‚¨çš„å§“å');
                    return;
                }

                const { data: existing } = await supabase
                    .from('participants')
                    .select('name')
                    .eq('game_code', currentGameCode)
                    .eq('name', name);

                if (existing && existing.length > 0) {
                    alert('æ­¤å§“åå·²è¢«ä½¿ç”¨');
                    return;
                }

                const gift = document.getElementById('participant-gift-input').value.trim() || '(å°šæœªå¡«å¯«)';

                const { error } = await supabase
                    .from('participants')
                    .insert({
                        game_code: currentGameCode,
                        name: name,
                        gift: gift
                    });

                if (error) throw error;

                alert('âœ… å·²åŠ å…¥æ´»å‹•ï¼');
                backToParticipantView();
            } catch (error) {
                alert('åŠ å…¥å¤±æ•—ï¼š' + error.message);
            }
        }

        // é¡¯ç¤ºæ–°å¢åƒåŠ è€…è¡¨å–®ï¼ˆç™¼èµ·äººç”¨ï¼‰
        function showAddParticipantForm() {
            document.getElementById('add-participant-name').value = '';
            document.getElementById('add-participant-gift').value = '';
            showSection('add-participant-section');
        }

        // ç™¼èµ·äººæ–°å¢åƒåŠ è€…
        async function addParticipantByHost() {
            try {
                const name = document.getElementById('add-participant-name').value.trim();
                
                if (!name) {
                    alert('è«‹è¼¸å…¥åƒåŠ è€…å§“å');
                    return;
                }

                const { data: existing } = await supabase
                    .from('participants')
                    .select('name')
                    .eq('game_code', currentGameCode)
                    .eq('name', name);

                if (existing && existing.length > 0) {
                    alert('æ­¤å§“åå·²è¢«ä½¿ç”¨');
                    return;
                }

                const gift = document.getElementById('add-participant-gift').value.trim() || '(å°šæœªå¡«å¯«)';

                const { error } = await supabase
                    .from('participants')
                    .insert({
                        game_code: currentGameCode,
                        name: name,
                        gift: gift
                    });

                if (error) throw error;

                alert('âœ… å·²æ–°å¢åƒåŠ è€…ï¼');
                backToActivityInfoFromAdd();
            } catch (error) {
                alert('æ–°å¢å¤±æ•—ï¼š' + error.message);
            }
        }

        // å¾æ–°å¢åƒåŠ è€…è¿”å›æ´»å‹•è³‡è¨Š
        function backToActivityInfoFromAdd() {
            showSection('activity-info-section');
        }

        // é€²å…¥éŠæˆ²ç‰ˆé¢ï¼ˆå¾æ´»å‹•è³‡è¨Šï¼‰
        function enterGameFromInfo() {
            loadGameMode();
        }

        // è¿”å›æ´»å‹•è³‡è¨Šï¼ˆå¾éŠæˆ²ï¼‰
        function backToActivityInfoFromGame() {
            stopPolling();
            showSection('activity-info-section');
            startPolling('info');
        }

        // é€²å…¥éŠæˆ²æ¨¡å¼ï¼ˆå¾é¦–é ï¼‰
        async function enterGameMode() {
            try {
                const activityName = document.getElementById('game-activity-name').value.trim();
                
                if (!activityName) {
                    alert('è«‹è¼¸å…¥æ´»å‹•åç¨±');
                    return;
                }

                const { data, error } = await supabase
                    .from('games')
                    .select('*')
                    .ilike('activity_name', activityName)
                    .single();

                if (error || !data) {
                    alert('æ‰¾ä¸åˆ°æ­¤æ´»å‹•');
                    return;
                }

                currentGameCode = data.game_code;
                currentActivityData = data;
                loadGameMode();
            } catch (error) {
                alert('è¼‰å…¥å¤±æ•—ï¼š' + error.message);
            }
        }

        // è¼‰å…¥éŠæˆ²æ¨¡å¼
        function loadGameMode() {
            document.getElementById('game-activity-name-display').textContent = currentActivityData.activity_name;
            showSection('game-section');
            startPolling('game');
        }

        // è½‰ç›¤åŠŸèƒ½
        function spinWheel() {
            // åªæŠ½é¸æœªè¢«é¸èµ°çš„åƒåŠ è€…
            const availableParticipants = participants.filter(p => p.gift !== 'å·²è¢«é¸èµ°');
            
            if (availableParticipants.length === 0) {
                alert('æ‰€æœ‰ç¦®ç‰©éƒ½å·²è¢«é¸èµ°äº†ï¼');
                return;
            }

            const spinBtn = document.getElementById('spin-btn');
            spinBtn.disabled = true;

            const randomIndex = Math.floor(Math.random() * availableParticipants.length);
            const rotations = 5 + Math.random() * 3;
            const degreesPerPerson = 360 / availableParticipants.length;
            const targetDegree = rotations * 360 + (randomIndex * degreesPerPerson);
            
            wheelRotation += targetDegree;
            
            const wheel = document.getElementById('wheel');
            wheel.style.transform = `rotate(${wheelRotation}deg)`;

            setTimeout(() => {
                const winner = availableParticipants[randomIndex];
                document.getElementById('result-display').innerHTML = `
                    <div class="result-box">
                        <div style="font-size: 18px; color: #666;">æŠ½ä¸­çš„æ˜¯</div>
                        <div class="result-name">${winner.name}</div>
                        <div style="font-size: 14px; color: #666; margin-top: 10px;">
                            ç¦®ç‰©ï¼š${winner.gift}
                        </div>
                    </div>
                `;
                spinBtn.disabled = false;
            }, 3000);
        }

        // æ¨™è¨˜ç¦®ç‰©å·²é¸èµ°
        async function toggleGiftStatus(participantId, currentStatus) {
            try {
                const newGift = currentStatus === 'å·²è¢«é¸èµ°' ? '(å°šæœªå¡«å¯«)' : 'å·²è¢«é¸èµ°';
                
                const { error } = await supabase
                    .from('participants')
                    .update({ gift: newGift })
                    .eq('id', participantId);

                if (error) throw error;

                loadParticipants('game');
            } catch (error) {
                alert('æ›´æ–°å¤±æ•—ï¼š' + error.message);
            }
        }

        // é–‹å§‹è¼ªè©¢
        function startPolling(type) {
            loadParticipants(type);
            if (pollInterval) clearInterval(pollInterval);
            pollInterval = setInterval(() => loadParticipants(type), 3000);
        }

        // åœæ­¢è¼ªè©¢
        function stopPolling() {
            if (pollInterval) {
                clearInterval(pollInterval);
                pollInterval = null;
            }
        }

        // è¼‰å…¥åƒèˆ‡è€…
        async function loadParticipants(type) {
            try {
                const { data, error } = await supabase
                    .from('participants')
                    .select('*')
                    .eq('game_code', currentGameCode)
                    .order('created_at');

                if (error) throw error;

                participants = data || [];
                
                if (type === 'info') {
                    updateInfoParticipantsList(participants);
                } else if (type === 'view') {
                    updateViewParticipantsList(participants);
                } else if (type === 'game') {
                    updateGameParticipantsList(participants);
                    updateWheelNames(participants);
                } else if (type === 'link-view') {
                    updateLinkViewParticipantsList(participants);
                }
            } catch (error) {
                console.error('è¼‰å…¥åƒèˆ‡è€…å¤±æ•—ï¼š', error);
            }
        }

        // æ›´æ–°æ´»å‹•è³‡è¨Šçš„åƒèˆ‡è€…åˆ—è¡¨
        function updateInfoParticipantsList(participants) {
            const count = participants.length;
            document.getElementById('info-participant-count').textContent = count;

            const listDiv = document.getElementById('info-participants-list');
            
            if (count === 0) {
                listDiv.innerHTML = `<div class="empty-state"><div class="empty-icon">ğŸ‘¥</div><div>é‚„æ²’æœ‰äººåƒåŠ </div></div>`;
            } else {
                listDiv.innerHTML = participants.map(p => `
                    <div class="player-item">
                        <div class="player-name">${p.name}</div>
                        <div class="player-gift">ç¦®ç‰©ï¼š${p.gift}</div>
                    </div>
                `).join('');
            }
        }

        // æ›´æ–°æŸ¥çœ‹åƒèˆ‡è€…åˆ—è¡¨
        function updateViewParticipantsList(participants) {
            const count = participants.length;
            document.getElementById('view-participant-count').textContent = count;

            const listDiv = document.getElementById('view-participants-list');
            
            if (count === 0) {
                listDiv.innerHTML = `<div class="empty-state"><div class="empty-icon">ğŸ‘¥</div><div>é‚„æ²’æœ‰äººåƒåŠ </div></div>`;
            } else {
                listDiv.innerHTML = participants.map(p => `
                    <div class="player-item">
                        <div class="player-name">${p.name}</div>
                        <div class="player-gift">ç¦®ç‰©ï¼š${p.gift}</div>
                    </div>
                `).join('');
            }
        }

        // æ›´æ–°é€£çµæŸ¥çœ‹åƒèˆ‡è€…åˆ—è¡¨ï¼ˆå¯ä»¥åƒåŠ ï¼‰
        function updateLinkViewParticipantsList(participants) {
            const count = participants.length;
            document.getElementById('link-participant-count').textContent = count;

            const listDiv = document.getElementById('link-participants-list');
            
            if (count === 0) {
                listDiv.innerHTML = `<div class="empty-state"><div class="empty-icon">ğŸ‘¥</div><div>é‚„æ²’æœ‰äººåƒåŠ </div></div>`;
            } else {
                listDiv.innerHTML = participants.map(p => `
                    <div class="player-item">
                        <div class="player-name">${p.name}</div>
                        <div class="player-gift">ç¦®ç‰©ï¼š${p.gift}</div>
                    </div>
                `).join('');
            }
        }

        // æ›´æ–°éŠæˆ²çš„åƒèˆ‡è€…åˆ—è¡¨
        function updateGameParticipantsList(participants) {
            const count = participants.length;
            document.getElementById('game-participant-count').textContent = count;

            const listDiv = document.getElementById('game-participants-list');
            const giftsDiv = document.getElementById('gifts-list');
            
            if (count === 0) {
                listDiv.innerHTML = `<div class="empty-state"><div class="empty-icon">ğŸ‘¥</div><div>é‚„æ²’æœ‰äººåƒåŠ </div></div>`;
                giftsDiv.innerHTML = listDiv.innerHTML;
            } else {
                listDiv.innerHTML = participants.map(p => `
                    <div class="player-item">
                        <div class="player-name">${p.name}</div>
                        <div class="player-gift">ç¦®ç‰©ï¼š${p.gift}</div>
                    </div>
                `).join('');

                giftsDiv.innerHTML = participants.map(p => {
                    const isTaken = p.gift === 'å·²è¢«é¸èµ°';
                    return `
                        <div class="player-item">
                            <div class="player-name">${p.name}</div>
                            <div class="player-gift">ç¦®ç‰©ï¼š${p.gift}</div>
                            <span class="gift-status ${isTaken ? 'gift-taken' : 'gift-available'}">
                                ${isTaken ? 'å·²è¢«é¸èµ°' : 'å¯é¸'}
                            </span>
                            <button class="btn btn-small ${isTaken ? 'btn-success' : 'btn-danger'}" 
                                    onclick="toggleGiftStatus(${p.id}, '${isTaken ? 'å·²è¢«é¸èµ°' : 'å¯é¸'}')">
                                ${isTaken ? 'æ¨™è¨˜ç‚ºå¯é¸' : 'æ¨™è¨˜ç‚ºå·²é¸èµ°'}
                            </button>
                        </div>
                    `;
                }).join('');
            }
        }

        // æ›´æ–°è½‰ç›¤åç¨±ï¼ˆåªé¡¯ç¤ºæœªè¢«é¸èµ°çš„ï¼‰
        function updateWheelNames(participants) {
            const availableParticipants = participants.filter(p => p.gift !== 'å·²è¢«é¸èµ°');
            const namesDiv = document.getElementById('wheel-names');
            if (availableParticipants.length === 0) {
                namesDiv.innerHTML = '<div style="color: #8b1a2e;">æ‰€æœ‰ç¦®ç‰©å·²è¢«é¸èµ°</div>';
            } else {
                namesDiv.innerHTML = availableParticipants.map(p => `<div>${p.name}</div>`).join('');
            }
        }

        // é é¢å¸è¼‰æ™‚åœæ­¢è¼ªè©¢
        window.addEventListener('beforeunload', stopPolling);
    </script>
</body>
</html>
